<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>New Years Giorno's Theme</title>
	</head>
	
	<body>
		<div class="audio">
			<audio id="song">
				<source src="https://drive.google.com/uc?export=download&id=1wEYlJxGe370NlhQhvQmviUVSVsOGi8NM" type="audio/ogg">
			</audio>
			<audio id="dramatic">
				<source src="https://drive.google.com/uc?export=download&id=171f9b-ey_bYkR6LHltO6rAJiEIvdFYLD" type="audio/ogg">
			</audio>
			<audio id="custom">
				<source src="" type="audio/ogg">
			</audio>
			
		</div>
		
		<div class= "introduction"> 
		<h1>New Years Giorno's Theme Alligner</h1>
		<br>
		
		<p> This website will allow you to allign the epic part of Giorno's theme with new years without the stress of figuring out when to press play!<br> all you need to do is enter the time left in the countdown and then enter the timestamp in the song that should be alligned. It's that simple!<br>I understand this website is ugly as fudge but I'm lazy and don't feel like relearining css and html styling. It functions, isn't that good enough for you?! ... geez</p>
			
		<br>
			<marquee scrollamount="20">This is here because every crappy website needs scrolling text at some point.</marquee>
		</div>
		
		<div class="userInput">
		<label for="dramaticCheck">Use dramatic version</label>
		<input type="checkbox" name="checkDramatic" id="dramaticCheck" value="dramatic"/>
		<label for="remaining"><br>Time Remaining (MM:SS OR SSS):</label>
		<input value="4:00" type="text" name="txtTimeRemaining" id="remaining"/>
			
		<!-- <br>-->
		<h3>Add your own song!</h3>
		<label for="customCheck">Use custom song</label>
		<input type="checkbox" name="checkCustom" id="customCheck" value="custom"/>
		
		<p> use this <a href="https://sites.google.com/site/gdocs2direct/">website</a> to create a direct download link to an mp3 you have in Google Drive.<br>Alternatively, you can paste a youtube link, but the timing may be slightly off. For youtube, you can use either the link in the address bar or the share button, but DO NOT ALTER THE LINK AND DO NOT ADD A START TIME TO THE LINK</p>
		<label for="txtCustom">Custom song link:</label>
		<input type="text" name="customLink" id="customLink"/>
		
		<label for="timestamp"><br>Timestamp to allign to (Only for custom songs):</label>
		<input type="text" name="txtTimestamp" id="timestamp" value=""/>
		
		<br><br><button onClick="runCountdown()">Start</button>
		<p>Tip: don't press start until the countdown changes to the desired second(aka don't try to click early to get it right on the second)</p>
		<br><h3 id="testOutput"></h3>
			
		<!--This frame will contain the embedded youtube video if they choose to use a youtube link-->
		<iframe id="youtubeFrame" width="1" height="1" src="https://www.youtube.com/embed/ov5qRvWCavg?start=2&autoplay=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen ></iframe>
			
		<script>
			var youtube = false;
			
			function runCountdown() {
				// convert given times to seconds
				var remaining = document.getElementById("remaining").value;
				var timestamp = document.getElementById("timestamp").value;
				//document.getElementById("testOutput").innerHTML = remaining;
				
				var remainingSec = calculateSeconds(remaining, "remaining");
				//var timestampSec = calculateSeconds(timestamp, "timestamp");
				
				if (document.getElementById("dramaticCheck").checked) {
					var timestampSec = 100;
				} else if(document.getElementById("customCheck").checked){
					
					if (document.getElementById("customLink").value.includes("youtu")) {
						document.getElementById("testOutput").innerHTML = "dogs";
						youtube = true;
					} else {
						document.getElementById("custom").src = document.getElementById("customLink").value;
					}
					var timestampSec = calculateSeconds(timestamp, "timestamp");
				} else {
					var timestampSec = 226;	
				}
				
				//do the thing
				waitToPlay(remainingSec, timestampSec);
				
			}
			
			function calculateSeconds(strTime, id) {
				var intTime = 0;
				// get rid of any spaces entered by accident
				while(strTime.includes(" ")) {
					strTime = strTime.replace(" ", "");
				}
				// update the value to remove spaces
				document.getElementById(id).value = strTime;
				
				// check if they included minutes
				// calculate time
				if (strTime.includes(":")) {
					intTime = parseInt(strTime.substring(0,strTime.indexOf(":"))) * 60;
					intTime += parseInt(strTime.substring(strTime.indexOf(":") + 1, strTime.length));
						
				} else {
					intTime = parseInt(strTime);
				}
				
				return intTime;
			}
			
			function waitToPlay(timeRemaining, timestamp) {
				timeRemaining = parseInt(timeRemaining);
				timestamp = parseInt(timestamp);
				//document.getElementById("testOutput").innerHTML = (timeRemaining > timestamp);
				if (timeRemaining > timestamp) {
					var waitTime = (timeRemaining - timestamp) * 1000 - 500;
					document.getElementById("testOutput").innerHTML = "Waiting " + waitTime / 1000 + " seconds to start.";
					setTimeout(function() {
						if(!youtube) {
							playMusic(0);
						} else {
							//document.getElementById("testOutput").innerHTML = "test";
							var url = formatUrl(2);
							document.getElementById("testOutput").innerHTML = "Now Playing";
							document.getElementById("youtubeFrame").src = url;
						}
					}, waitTime);
				} else {
					var startTime = timestamp - timeRemaining;
					if(!youtube) {
						document.getElementById("testOutput").innerHTML = startTime;
						playMusic(startTime + .5);
					} else {
						document.getElementById("testOutput").innerHTML = "Now Playing";
						document.getElementById("youtubeFrame").src = formatUrl(startTime + 2);
					}
				}
			}
			
			function playMusic(startTime) {
				document.getElementById("testOutput").innerHTML = "Now Playing";
				if (document.getElementById("dramaticCheck").checked) {
					var song = document.getElementById("dramatic");
				} else if (document.getElementById("customCheck").checked) {
					var song = document.getElementById("custom");
				}else {
					var song = document.getElementById("song");
				}
				song.currentTime = startTime;
				song.play();
			}
			
			
			function formatUrl(startTime) {
				var url = document.getElementById("customLink").value;
				//document.getElementById("testOutput").innerHTML = url;
				if(url.includes("https://")) {
					url = url.replace("https://", "");
				}
				
				if(url.includes("youtu.be")) {
					url = url.replace("youtu.be", "www.youtube.com");
				} 
				
				if (url.includes("watch?v=")) {
					url = url.replace("watch?v=", "");
				}
				var split = url.indexOf("/")
				url = "https://" + url.substring(0, split) + "/embed/" + url.substring(split + 1, url.lenght);
				var end = "?start=" + startTime + "&autoplay=1";
				url = url.concat(end);
				
				return url;
			}
			
		</script>
		</div>
		
	</body>
</html>
